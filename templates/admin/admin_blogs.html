<!DOCTYPE html>
<html>
<head>
    <title>博客管理</title>
    <!-- 引入 Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- 引入 Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    {% include './admin/navbar.html' %}
    <div class="container">
        <h1 class="mt-4 mb-4">博客管理</h1>
        <p>所有博客总数：{{ blog_count }}</p>

        <!-- 添加一个 canvas 元素来放置图表 -->
        <canvas id="chart"></canvas>

        {% for user in users %}
        {% if user.blogs and user.blog_count > 0 %}
        <div class="card mt-4">
            <div class="card-header">
                <h2 >{{ user.username }}的博客 </h2>
                <p>博客总数：{{ user.blog_count }}</p>
            </div>
            <div class="card-body">
                <table class="table">
                    <tr>
                        <th>标题</th>
                        <th>发布日期</th>
                        <th>点赞数</th>  <!-- 添加点赞数列 -->
                        <th>反赞数</th>  <!-- 添加反赞数列 -->
                        <th>操作</th>
                    </tr>
                    {% for blog in user.blogs %}
                    <tr>
                        <td><a href="{{ url_for('show_blog', blog_id=blog.blog_id) }}">{{ blog.title }}</a></td>
                        <td>{{ blog.publish_date }}</td>
                        <td>{{ blog_votes[blog.blog_id].upvotes }}</td>  <!-- 显示点赞数 -->
                        <td>{{ blog_votes[blog.blog_id].downvotes }}</td>  <!-- 显示反赞数 -->
                        <td>
                            <form action="{{ url_for('admin_delete_blog', blog_id=blog.blog_id) }}" method="post" style="display: inline;">
                                <input type="submit" class="btn btn-danger btn-sm" value="删除博客">
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        {% endif %}
        {% else %}
        <p>目前没有用户。</p>
        {% endfor %}
    </div>

    <footer class="footer mt-auto py-3 bg-light">
        <div class="container" style="text-align: center;">
            <span class="text-muted">博客信息管理系统</span>
        </div>
    </footer>

    <!-- 引入 Bootstrap JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- 创建图表 -->
    <script>
    var ctx = document.getElementById('chart').getContext('2d');
    var chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: [{% for user in users %}'{{ user.username }}',{% endfor %}],  // 用户名
            datasets: [{
                label: '博客数',
                data: [{% for user in users %}{{ user.blog_count }},{% endfor %}],  // 博客数
                backgroundColor: 'rgba(75, 192, 192, 0.2)',  // 柱状图的颜色
                borderColor: 'rgba(75, 192, 192, 1)',  // 柱状图边框的颜色
                borderWidth: 1,  // 柱状图边框的宽度
                hoverBackgroundColor: 'rgba(75, 192, 192, 0.4)',  // 鼠标悬停时的颜色
                hoverBorderColor: 'rgba(75, 192, 192, 1)'  // 鼠标悬停时的边框颜色
            }]
        },
        options: {
            responsive: true,  // 让图表在响应式环境中工作
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            animation: {
                duration: 1000,  // 动画持续时间
                easing: 'easeOutBounce'  // 动画效果
            },
            title: {
                display: true,
                text: '用户的博客数',  // 图表标题
                fontColor: '#333',  // 标题颜色
                fontSize: 20  // 标题字体大小
            },
            legend: {
                display: false  // 不显示图例
            }
        }
    });
    </script>
</body>
</html>
